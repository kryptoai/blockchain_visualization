<!doctype html>
<html>
<head>
    <title>Network | DataSet</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <style type="text/css">
        html, body {
            font: 11pt arial;
        }

        h1 {
            font-size: 150%;
            margin: 5px 0;
        }

        h2 {
            font-size: 100%;
            margin: 5px 0;
        }

        table.view {
            width: 100%;
        }

        table td {
            vertical-align: top;
        }

        table table {
            background-color: #f5f5f5;
            border: 1px solid #e5e5e5;
        }

        table table td {
            vertical-align: middle;
        }

        input[type=text], pre {
            border: 1px solid lightgray;
        }

        pre {
            margin: 0;
            padding: 5px;
            font-size: 10pt;
        }

        #network {
            width: 100%;
            height: 400px;
            border: 1px solid lightgray;
        }
    </style>

    <script type="text/javascript" src="./dist/vis.js"></script>
    <link href="./dist/vis-network.min.css" rel="stylesheet" type="text/css"/>

    <script type="text/javascript">
        var nodes, edges, network;

        // convenience method to stringify a JSON object
        function toJSON(obj) {
            return JSON.stringify(obj, null, 4);
        }

        function createNetwork() {

            $.ajax({
                url: "http://localhost:5000/",
                dataType: "jsonp",
                success: function(data){
                    try {

                        // for (var i=0;i < data["nodes"].length; i++){
                        //     nodes.add({
                        //         id: data["nodes"][i],
                        //         label: data["nodes"][i]
                        //     });
                        // }

                        // for (var i=0; i<data["edges"].length; i++){
                        //     for (j in data["edges"][i]){

                        //         edges.add({
                        //             id: j,
                        //             from: j,
                        //             to: data["edges"][i][j]
                        //         });

                        //     }
                        // }

                        // // create a network
                        // var container = document.getElementById('network');
                        // var data = {
                        //     nodes: nodes,
                        //     edges: edges
                        // };
                        // var options = { };
                        // network = new vis.Network(container, data, options);

                        // network.on("stabilizationIterationsDone", function () {
                        //     network.setOptions({
                        //         physics: {enabled: false}
                        //     });
                        // });

                        var nodeData;
                        for (var i=0;i<200;i++){
                            nodes.add({
                                id: i,
                                label: i
                            });

                            // nodeData += (i + " ,");

                        }

                        // document.getElementById('nodes').innerHTML = nodeData;

                        var j=1;
                        var idNum=0;
                        while (j!==200){
                            edges.add({
                                id: idNum,
                                from: 0,
                                to: j

                            });
                            idNum++;
                            j++;
                        }

                    }
                    catch (err) {
                        alert(err);
                    }

                }
            });

        }

        function addNode() {

            $.ajax({
                url: "http://localhost:5000/",
                dataType: "jsonp",
                success: function(data){

                    try {
                        nodes.add({
                            id: data["node"],
                            label: data["label"]
                        });
                    }
                    catch (err) {
                        alert(err);
                    }

                    console.log(data);
                }
            });
        }

        function manAddNode() {
            try {
                nodes.add({
                    id: document.getElementById('node-id').value,
                    label: document.getElementById('node-label').value
                });
            }
            catch (err) {
                alert(err);
            }

            console.log(data);
        }

        function updateNode() {
            try {
                nodes.update({
                    id: document.getElementById('node-id').value,
                    label: document.getElementById('node-label').value
                });
            }
            catch (err) {
                alert(err);
            }
        }
        function removeNode() {
            try {
                nodes.remove({id: document.getElementById('node-id').value});
            }
            catch (err) {
                alert(err);
            }
        }

        function addEdge() {
            try {
                edges.add({
                    id: document.getElementById('edge-id').value,
                    from: document.getElementById('edge-from').value,
                    to: document.getElementById('edge-to').value
                });
            }
            catch (err) {
                alert(err);
            }
        }
        function updateEdge() {
            try {
                edges.update({
                    id: document.getElementById('edge-id').value,
                    from: document.getElementById('edge-from').value,
                    to: document.getElementById('edge-to').value
                });
            }
            catch (err) {
                alert(err);
            }
        }
        function removeEdge() {
            try {
                edges.remove({id: document.getElementById('edge-id').value});
            }
            catch (err) {
                alert(err);
            }
        }

        function draw() {
            // create an array with nodes
            nodes = new vis.DataSet();
            nodes.on('*', function () {
            document.getElementById('nodes').innerHTML = JSON.stringify(nodes.get(), null, 4);
            // console.log(nodes.get())
            // nodes = nodes.get();
            // for(var i=0;i<nodes.length;i++){
            //     console.log(nodes[i][0]["id"]);
            // }

            // var addresses = JSON.stringify(nodes.get(), null, 4);
            //     for (address in addresses){
            //         document.getElementById('nodes').innerHTML += ( address["id"] + ", ");
            //     }

            });
            nodes.add([
                // {id: '1', label: 'Node 1'},
                // {id: '2', label: 'Node 2'},
                // {id: '3', label: 'Node 3'},
                // {id: '4', label: 'Node 4'},
                // {id: '5', label: 'Node 5'}
            ]);

            // create an array with edges
            edges = new vis.DataSet();
            edges.on('*', function () {
                // document.getElementById('edges').innerHTML = JSON.stringify(edges.get(), null, 4);
            });
            edges.add([
                // {id: '1', from: '1', to: '2'},
                // {id: '2', from: '1', to: '3'},
                // {id: '3', from: '2', to: '4'},
                // {id: '4', from: '2', to: '5'}
            ]);

            // create a network
            var container = document.getElementById('network');
            var data = {
                nodes: nodes,
                edges: edges
            };
            // var options = {  };
            var options = {
                nodes: {
                    size: 20,
                    scaling: {
                        min: 50,
                        max: 50,
                        label: {
                            min: 8,
                            max: 10,
                            maxVisible: 40
                        }
                    },
                    font: {
                        size: 10,
                        face: 'Tahoma'
                    }
                },
                edges: {
                    width: 1,
                    color: {
                        color: 'rgba(0,100,102,0.3)',
                        highlight: 'rgba(0,0,102,0.7)',
                        hover: 'rgba(0,0,102,0.3)'
                    },
                    smooth: {
                        type: 'continuous'
                    }
                },
                physics: {
                    minVelocity: 0.75,
                    maxVelocity: 25,
                    solver: "forceAtlas2Based",
                    // iterations: 100,
                    timestep: 0.5,
                    forceAtlas2Based: {
                        springLength: 100,
                        springConstant: 0.03
                    }
                },
                interaction: {
                    hover: true,
                    hideEdgesOnDrag: false,
                    zoomView: true,
                    dragView: true,
                    // navigationButtons: true
                },
                layout: {
                }
            }

            network = new vis.Network(container, data, options);


            network.on( "click", function(properties) {
                // console.log(properties);
                var ids = properties.nodes;
                var edge = properties.edges;
                var clickedNodes = nodes.get(ids);
                var clickedEdges = edges.get(edge);
                console.log(clickedEdges);

                var output = "Transaction Hash: " + clickedEdges[0]["id"] + " From: " + clickedEdges[0]["from"] + " To: " + clickedEdges[0]["to"];

                document.getElementById('edges').innerHTML = output;
                // console.log(clickedNodes);
                // console.log('clicked node ID: ', clickedNodes[0]["id"]);
                // console.log('clicked nodes Label: ', clickedNodes[0]["label"])
            });

        }

    </script>
    
</head>

<body onload="draw();">

<h1>Wallet Tracking</h1>
<table>
    <tr>
        <td>
            <table>
                <tr>
                    <td></td>
                    <td><label for="node-id">BTC Wallet Address</label></td>
                    <td><input id="node-id" type="text" value="6"></td>
                </tr>

                <tr>
                    <td></td>

                    <td>
                        <button id="node-add" onclick="createNetwork();">Search</button>

                    </td>
                </tr>
            </table>
        </td>


    </tr>

</table>

<h1>View</h1>
<table class="view">
    <colgroup>
        <col width="25%">
        <col width="25%">
        <col width="50%">
    </colgroup>
    <tr>
        <td>
            <h2>Addresses</h2>
            <pre id="nodes"></pre>
        </td>

        <td>
            <h2>Transactions</h2>
            <pre id="edges"></pre>
        </td>

        <td>
            <h2>Wallet Interaction</h2>
            <div id="network"></div>
        </td>
<!-- 
        <td>
            <h2>Transactions</h2>
            <pre id="edges"></pre>
        </td> -->

    </tr>
</table>

</body>
</html>
